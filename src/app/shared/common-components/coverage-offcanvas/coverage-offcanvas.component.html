<div class="canvas-container d-flex flex-column">
  <div
    class="bg-primary d-flex justify-content-between align-items-center text-white p-4 text-md"
  >
    <p>{{ config.title }}</p>
    <img
      class="cursor-pointer"
      [src]="imgPath + 'images/icon-close.svg'"
      alt="icon-close"
      (click)="offcanvasService.dismiss()"
    />
  </div>

  <div class="px-4 py-3 offcanvas-body" [formGroup]="form">
    <div class="input-icon icon-search">
      <input
        type="text"
        class="form-control"
        [placeholder]="config.searchPlaceholder"
      />
    </div>
    <div class="mt-3">
      <div *ngFor="let item of config.fields" class="cover-item mb-3">
        <div *ngIf="item._visible">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [id]="item.name"
              [formControlName]="
                item.subFields ? item.name + '_checked' : item.name
              "
            />
            <label class="text-sm" [for]="item.name">{{ item.label }}</label>
          </div>

          <div
            class="dependent-fields row mt-2"
            *ngIf="item.subFields && form.get(item.name + '_checked')?.value"
            [formGroupName]="item.name"
          >
            <div
              *ngFor="let field of item.subFields"
              [ngClass]="{ 'col-4 ps-0': field._visible }"
            >
              <div [ngSwitch]="field.type">
                <div *ngIf="field._visible">
                  <label
                    [for]="field.name"
                    [class.required]="
                      field.validators?.required ||
                      field.validatorsWhen?.required
                    "
                    class="form-label text-sm"
                    >{{ field.label }}</label
                  >
                  <input
                    *ngSwitchCase="'input'"
                    [type]="field.inputType || 'text'"
                    class="form-control"
                    [id]="field.name"
                    [placeholder]="field.placeholder"
                    [formControlName]="field.name"
                  />
                  <div
                    *ngSwitchCase="'select'"
                    class="field-container"
                    [ngClass]="{ 'readonly-wrapper': field.readonly }"
                  >
                    <ng-select
                      [items]="field.options"
                      [placeholder]="field.placeholder"
                      [formControlName]="field.name"
                      [ngClass]="{ readonly: field.readonly }"
                    ></ng-select>
                    <div
                      *ngIf="
                        getControl(item.name)[field.name].invalid &&
                        getControl(item.name)[field.name].touched
                      "
                      class="invalid-feedback d-block"
                    >
                      {{ field.errors?.required }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="px-3 py-2 mt-auto shadow-lg">
    <button
      class="btn btn-primary btn-sm px-5"
      (click)="offcanvasService.dismiss()"
    >
      {{ config.doneButtonLabel }}
    </button>
  </div>
</div>
