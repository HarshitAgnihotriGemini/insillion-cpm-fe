<section class="section-card mb-4" [formGroup]="form">
  <div
    class="card-header"
    [ngClass]="{ accordian: isCollapsible }"
    (click)="toggle()"
  >
    <div class="text-md font-semibold">{{ section.title }}</div>
    <span
      *ngIf="isCollapsible"
      class="accordion-toggle-icon"
      [class.expanded]="isExpanded"
    ></span>
  </div>

  <div
    class="accordion-content"
    [class.expanded]="isExpanded || !isCollapsible"
  >
    <div class="accordion-content-inner">
      <ng-container [ngSwitch]="section.componentType">
        <div *ngSwitchCase="'attachments'" class="form-section">
          <app-attachments
            [section]="section"
          >
          </app-attachments>
        </div>
        <div>
          <div
            *ngFor="let subsection of section.subsections"
            class="form-section"
          >
            <ng-container
              *ngIf="subsection.type === 'form-array'; else standardSection"
            >
              <p
                class="text-base text-blue-secondary font-semibold mb-lg"
                *ngIf="subsection.title"
              >
                {{ subsection.title }}
              </p>
              <div [formArrayName]="subsection.name">
                <div
                  *ngFor="
                    let group of getFormArray(subsection.name).controls;
                    let i = index
                  "
                  class="form-array-group mb-lg"
                >
                  <div [formGroupName]="i" class="row gy-4 gx-5">
                    <div
                      class="col-12 d-flex justify-content-between align-items-center p-0"
                    >
                      <p
                        class="text-base text-primary font-semibold mb-md"
                        *ngIf="subsection.title"
                      >
                        {{ subsection.title }} {{ i + 1 }}
                      </p>
                      <div
                        class="d-inline-flex align-items-center text-red-200 text-base cursor-pointer"
                        (click)="removeGroup(subsection, i)"
                      >
                        <img src="images/icon-remove.svg" alt="remove icon" />
                        <span class="ms-1">Remove</span>
                      </div>
                    </div>
                    <div
                      *ngFor="let field of subsection.formGroupTemplate"
                      class="col-4 ps-0"
                    >
                      <app-form-field
                        [field]="field"
                        [form]="getFormGroup(group)"
                        (buttonClick)="buttonClick.emit($event)"
                      ></app-form-field>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-4 col-4 pe-4">
                <button
                  type="button"
                  class="btn btn-outline btn-md w-100"
                  (click)="addGroup(subsection)"
                >
                  <img
                    src="images/icon-add.svg"
                    [alt]="subsection.addButtonLabel"
                    class="btn-icon"
                  />
                  <span>{{ subsection.addButtonLabel }}</span>
                </button>
              </div>
            </ng-container>
            <ng-template #standardSection
              ><p
                class="text-base text-blue-secondary font-semibold mb-lg"
                *ngIf="subsection.title"
              >
                {{ subsection.title }}
              </p>

              <div class="row gy-4 gx-5">
                <div *ngFor="let field of subsection.fields" class="col-4 ps-0">
                  <app-form-field
                    [field]="field"
                    [form]="form"
                    (buttonClick)="buttonClick.emit($event)"
                  >
                  </app-form-field>
                </div>
              </div>
              <div *ngIf="subsection.actions" class="mt-4 row gx-5">
                <div
                  *ngFor="let action of subsection.actions"
                  class="col-4 ps-0"
                >
                  <app-form-field
                    [field]="action"
                    [form]="form"
                    (buttonClick)="buttonClick.emit($event)"
                  ></app-form-field>
                </div></div
            ></ng-template>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</section>
